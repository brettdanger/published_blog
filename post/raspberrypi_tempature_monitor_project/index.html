<!DOCTYPE html>
<html lang="en">
   <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="img/favicon/favicon.png">

    <title>Building a wireless temperature sensor with a Raspberry Pi and Xbee Wireless modules</title>

    <!-- Bootstrap core CSS -->
    <!--<link href="static/css/bootstrap.css" rel="stylesheet">-->
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
    <!--<link href="static/css/bootstrap-theme.css" rel="stylesheet">-->

    <!-- Custom styles for this template -->
    <link href='http://fonts.googleapis.com/css?family=Raleway:400,800' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Noto+Serif:700,400italic' rel='stylesheet' type='text/css'>
    <link href="/static/css/font-awesome.min.css" rel="stylesheet">
    <link href="/static/css/github.css" type="text/css" rel="stylesheet">
    <link href="/static/css/style_mod.css" rel="stylesheet">
    <link href="/static/css/responsive.css" rel="stylesheet">
    <link href="/static/js/prettify/prettify.css" type="text/css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->

       <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-7196717-1', 'brettdangerfield.com');
  ga('send', 'pageview');

</script>
          <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
   <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/static/js/bootstrap.js"></script>
    <script src="/static/js/masonry.pkgd.min.js"></script>
    <script src="/static/js/imagesloaded.pkgd.min.js"></script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&amp;language=en"></script>
    <script src="/static/js/gmap3.min.js"></script>
    <script src="/static/js/jquery.isotope.min.js"></script>
    <script src="/static/js/jquery.easing.js"></script>
    <script src="/static/js/script.js"></script>
    <script type="text/javascript" src="/static/js/prettify/prettify.js"></script>

  </head>
  <body>

  <!-- HEADER HERE -->
       <!-- begin:navbar -->
    <nav class="navbar navbar-default navbar-transparent navbar-fixed-top" role="navigation">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-top">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/"><i class="fa fa-fighter-jet"></i> <span>Dang</span>er!</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="navbar-top">
          <ul class="nav navbar-nav navbar-right">
            <li  class=""><a href="/"><i class="icon-home icon-large"></i>Home</a></li>
              <li class=""><a href="/page/about"><i class="icon-user icon-large"></i>About</a></li>
              <li class=""><a href="/page/contact"><i class="icon-user icon-large"></i>Contact</a></li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>
    <!-- end:navbar -->

    <!-- begin:header -->
    <section id="header" class="heading" style="background: url(/static/img/backgrounds/sunset2.jpg);">
        <div class="container">
            <div class="row">
                <div class="col-md-8 col-md-offset-2">
                    <div class="title-desc">
                        
                            <h2>My Blog</h2>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="overlay"></div>
    </section>
    <!-- end:header -->

<section id="content">
      <div class="container">
        <div class="row">
            <div class="col-lg-9 col-md-8 col-sm-8 post-single">
                            <div class="heading-title">
    <h2><a href="/post/raspberrypi_tempature_monitor_project">Building a wireless temperature sensor with a Raspberry Pi and Xbee Wireless modules</a></h2>
</div>
<div class="post-meta">
    <span><em>13 Jun 2014 </em></span>
    <span><em>In <a href="#">Programming</a></em></span>
    <span class="right" ><i class="fa fa-comment"></i> <a href="/post/raspberrypi_tempature_monitor_project#disqus_thread" >0 Comments</a></span>
</div>
<div id="story"><h3>Project Introduction</h3>

<p>I have owned a Raspberry Pi for a few years now, and outside of <a href="">XMBC</a> I haven&#39;t done much with it. When I purchased it, I had the intent to do some cool electronic experiments but never tried.  A perfect sample project sprang up when my 2 year old son started to wake up in the middle of the night sweating because his room is too hot.  We keep our thermostat set at 72 degrees almost all the time, but our upper level stays quite warmer than the main level.  So in order to find the perfect thermostat setting I decided to build a temperature monitor that I can place in the boy&#39;s room and find the right setting.</p>

<p><img src="/static/img/pi_screen1.png" width="85%"></p>

<h3>Parts List</h3>

<p>Here are the parts you will need for this project:</p>

<ul>
<li>(2) <a href="https://www.sparkfun.com/products/11215">XBee Series1 Wireless Units</a></li>
<li>(1) <a href="https://www.sparkfun.com/products/8687">XBee Explorer USB Board</a> </li>
<li>(1) <a href="https://www.sparkfun.com/products/10988">TMP36 Analog Temperature Sensor</a></li>
<li>(1) <a href="https://www.sparkfun.com/products/8276">XBee Breakout Board</a></li>
<li>(1) <a href="https://www.sparkfun.com/products/11546">Raspberry Pi Model B</a></li>
<li><a href="https://www.sparkfun.com/categories/149">Jumper Wire, Breadboards, USB Cables, GPIO Cable</a></li>
<li>Optional: Solder, Project Box</li>
</ul>

<h3>Part One - Programming the XBee&#39;s</h3>

<p>Once all the parts arrive, we are going to use the USB Explorer board to connect our Xbee&#39;s to a computer and program them. The USB board provides the computer with a serial interface to the Xbee. We will use simple Serial AT Commands to program the Xbee.  In order to get started you will need to download and install these your platforms <a href="http://www.ftdichip.com/Drivers/VCP.htm">FTDI drivers</a>.</p>

<p>On my mac I used <a href="http://freeware.the-meiers.org/">Cool Term</a> to send AT commands to the Xbee&#39;s.  I simply connected the first xbee into the USB Explorer then plugged the USB into my mac.  This provided the Xbee with power and a com port to communicate with it.  Once plugged in I opened cool term and created a new connection at 9600 baud and both hardware and software flow control turned off.  In my port drop down I was able to choose the USB FTDI device. Once I hit connect I was able to start issuing some AT commands.</p>

<p><strong><a href="http://examples.digi.com/get-started/basic-xbee-802-15-4-chat/3/">This</a> is a great tutorial on how to configure the Xbee&#39;s. I recommend walking through this project first.</strong> This project will require two xbee USB explorer boards...or you can use the PI and set it up like I do below, then use a serial app like minicom to chat back and forth from your PC to your Pi.</p>

<p>For the first Xbee here is the settings I used.</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash">+++OK <span class="c">#enabled command mode</span>
ATID1 <span class="c">#set the network id</span>
ATMY1 <span class="c">#this sets this Xbee&#39;s device ID to 1</span>
ATDH0 <span class="c">#destination address Hi...not needed for our small network</span>
ATDL2 <span class="c">#this is the Xbee device id we want to communicate with</span>
ATWR <span class="c">#write the settings to the device</span>
</code></pre></div>
<p>For the second XBee I used the following settings:</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash">+++OK <span class="c">#enabled command mode</span>
ATID1 <span class="c">#set the network id</span>
ATMY1 <span class="c">#this sets this Xbee&#39;s device ID to 1</span>
ATDH0 <span class="c">#destination address Hi...not needed for our small network</span>
ATDL1 <span class="c">#this is the Xbee device id we want to communicate with</span>
ATD0 <span class="c">#set the devices 0 pin to analog mode since the temp sensor is analog</span>
ATIREA60 <span class="c">#Sample rate milliseconds in hex, so this is 60000 ms or 1 minute</span>
ATIT10 <span class="c">#sets the unit to send 10 samples at once...this means it will send 10 readings every 10 minutes</span>
ATWR <span class="c">#write the settings to the device</span>
</code></pre></div>
<p><strong><a href="https://cdn.sparkfun.com/assets/resources/2/9/22AT_Commands.pdf">Here</a> is a great reference of AT commands for the Xbee&#39;s.</strong></p>

<h3>Part Two - Wiring the Xbees</h3>

<p><strong>Setting up the sensor</strong>
Now the Xbee&#39;s are ready to chat with each other and we need to wire them up.  First up is the temperature sensing unit.  I am going to use the USB explorer, a breadboard, and some wires to wire it up like this:</p>

<p><img src="https://lh3.googleusercontent.com/-w8oiHNEsK00/U54jWRr0v3I/AAAAAAAAEb0/-HN7MIiXqPk/w964-h1112-no/xbee_tempature.png" width="65%"></p>

<p>Here is what mine looks like after connecting everything together and setting it in the freezer.</p>

<p><img src="https://lh3.googleusercontent.com/-lfixN0MZvVA/U54fza14ouI/AAAAAAAAEbM/VsJV3BFNBCM/w1000-h667-no/sam_1608.jpg" width="75%"></p>

<p><strong>Setting up the receiver</strong>
I used the GPIO ribbon cable for the pi and used male to male prototyping wires. I also used the XBee breakout board.  Here is the diagram:</p>

<p><img src="https://lh6.googleusercontent.com/-9bmIuENd0Ac/U54jWdn2hRI/AAAAAAAAEb4/0EZ-vA6siPw/w820-h1114-no/rasp_pi_to_xbee.png" width="55%"></p>

<p>Here is what mine looked like:</p>

<p><img src="https://lh6.googleusercontent.com/-T1Wd60JSmCA/U5vYgWAx39I/AAAAAAAAEaM/MwCyJFvO55s/w1000-h567-no/sam_1605.jpg" width="75%"></p>

<h3>Part Three - Software</h3>

<p>The sensor side is ready to go and should be sending packets of data every 10 min to the PI.  My Pi has the latest version of Rasbian on it.  First I just wanted to see if I could read the data from the Xbee.  For this I needed two python libraries: pyserial and xbee.  Both were available via pip.  Here is my app to read from the Xbee and print out the response.</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="kn">import</span> <span class="nn">serial</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">datetime</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">xbee</span> <span class="kn">import</span> <span class="n">XBee</span>

<span class="n">SERIALPORT</span> <span class="o">=</span> <span class="s">&quot;/dev/ttyAMA0&quot;</span>    <span class="c"># the com/serial port the XBee is connected to, the pi GPIO should always be ttyAMA0</span>
<span class="n">BAUDRATE</span> <span class="o">=</span> <span class="mi">9600</span>      <span class="c"># the baud rate we talk to the xbee</span>

<span class="n">ser</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="n">SERIALPORT</span><span class="p">,</span> <span class="n">BAUDRATE</span><span class="p">)</span>

<span class="n">xbee</span> <span class="o">=</span> <span class="n">XBee</span><span class="p">(</span><span class="n">ser</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&#39;Starting Up Tempature Monitor&#39;</span>
<span class="c"># Continuously read and print packets</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">xbee</span><span class="o">.</span><span class="n">wait_read_frame</span><span class="p">()</span>
        <span class="k">print</span> <span class="n">response</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="k">break</span>

<span class="n">ser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
<p>If everything is setup properly you should see some output like this every 10 min or so:</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash">Starting Up Tempature Monitor
<span class="o">{</span><span class="s1">&#39;rssi&#39;</span>: <span class="s1">&#39;O&#39;</span>, <span class="s1">&#39;source_addr&#39;</span>: <span class="s1">&#39;\x00\x11&#39;</span>, <span class="s1">&#39;id&#39;</span>: <span class="s1">&#39;rx_io_data&#39;</span>, <span class="s1">&#39;samples&#39;</span>: <span class="o">[{</span><span class="s1">&#39;adc-0&#39;</span>: 214<span class="o">}</span>, <span class="o">{</span><span class="s1">&#39;adc-0&#39;</span>: 215<span class="o">}</span>, <span class="o">{</span><span class="s1">&#39;adc-0&#39;</span>: 215<span class="o">}]</span>, <span class="s1">&#39;options&#39;</span>: <span class="s1">&#39;\x00&#39;</span><span class="o">}</span>
<span class="o">{</span><span class="s1">&#39;rssi&#39;</span>: <span class="s1">&#39;O&#39;</span>, <span class="s1">&#39;source_addr&#39;</span>: <span class="s1">&#39;\x00\x11&#39;</span>, <span class="s1">&#39;id&#39;</span>: <span class="s1">&#39;rx_io_data&#39;</span>, <span class="s1">&#39;samples&#39;</span>: <span class="o">[{</span><span class="s1">&#39;adc-0&#39;</span>: 215<span class="o">}</span>, <span class="o">{</span><span class="s1">&#39;adc-0&#39;</span>: 215<span class="o">}</span>, <span class="o">{</span><span class="s1">&#39;adc-0&#39;</span>: 215<span class="o">}]</span>, <span class="s1">&#39;options&#39;</span>: <span class="s1">&#39;\x00&#39;</span><span class="o">}</span>
<span class="o">{</span><span class="s1">&#39;rssi&#39;</span>: <span class="s1">&#39;O&#39;</span>, <span class="s1">&#39;source_addr&#39;</span>: <span class="s1">&#39;\x00\x11&#39;</span>, <span class="s1">&#39;id&#39;</span>: <span class="s1">&#39;rx_io_data&#39;</span>, <span class="s1">&#39;samples&#39;</span>: <span class="o">[{</span><span class="s1">&#39;adc-0&#39;</span>: 214<span class="o">}</span>, <span class="o">{</span><span class="s1">&#39;adc-0&#39;</span>: 218<span class="o">}</span>, <span class="o">{</span><span class="s1">&#39;adc-0&#39;</span>: 218<span class="o">}]</span>, <span class="s1">&#39;options&#39;</span>: <span class="s1">&#39;\x00&#39;</span><span class="o">}</span>
<span class="o">{</span><span class="s1">&#39;rssi&#39;</span>: <span class="s1">&#39;L&#39;</span>, <span class="s1">&#39;source_addr&#39;</span>: <span class="s1">&#39;\x00\x11&#39;</span>, <span class="s1">&#39;id&#39;</span>: <span class="s1">&#39;rx_io_data&#39;</span>, <span class="s1">&#39;samples&#39;</span>: <span class="o">[{</span><span class="s1">&#39;adc-0&#39;</span>: 216<span class="o">}</span>, <span class="o">{</span><span class="s1">&#39;adc-0&#39;</span>: 215<span class="o">}</span>, <span class="o">{</span><span class="s1">&#39;adc-0&#39;</span>: 213<span class="o">}]</span>, <span class="s1">&#39;options&#39;</span>: <span class="s1">&#39;\x00&#39;</span><span class="o">}</span>
</code></pre></div>
<p>The XBEE python library is great because we don&#39;t have to parse hexadecimal packets.  In each dictionary we get these attributes:</p>

<ul>
<li><strong>rssi</strong> - The signal strength</li>
<li><strong>source_addr</strong> - Which Xbee send the signal</li>
<li><strong>samples</strong> - an array of readings from each enabled IO pin. In this case pin 0  is sending 3 readings, you will see 10 readings if you configured your&#39;s the same as above.</li>
<li><strong>options</strong> - Not sure what options do yet</li>
</ul>

<p>The readings in the samples array is the voltage the temperature sensor is sending to the Xbee.  This now needs to be converted to a Celsius temperature. I had to do a ton of digging because the formulas I was finding just didn&#39;t make sense. It turns out it was different because I was using the 3.3V USB Explorer board. With that the formula was <code>temp in c = ((voltage from sensor *3.2258) - 500) / 10.</code>. In this formula the 3.2258 value represents the 3.3 volts of the USB board, which is feeding into the res pin as a reference.  If you were using a different board value would be 1023 multiplied by the number of volts.</p>

<p>For my final version I wanted to log the temperature to a SQLLite database file. I wanted to log the timestamp, temp and which sensor it came from (cause there will eventually be more than one).  Here is my final logging app:</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="kn">import</span> <span class="nn">serial</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">datetime</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">xbee</span> <span class="kn">import</span> <span class="n">XBee</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>


<span class="c">#get the current temp from a list of voltage readings</span>
<span class="k">def</span> <span class="nf">get_tempature</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&quot;C&quot;</span><span class="p">):</span>
    <span class="c">#iterate over data elements</span>
    <span class="n">readings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">readings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;adc-0&#39;</span><span class="p">))</span>

    <span class="c">#start by averaging the data</span>
    <span class="n">volt_average</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">readings</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">readings</span><span class="p">))</span>

    <span class="c">#now calculate the proper mv</span>
    <span class="c">#we are using a 3.3v usb explorer so the formula is slightly different</span>
    <span class="n">tempature</span> <span class="o">=</span> <span class="p">((</span><span class="n">volt_average</span><span class="o">*</span><span class="mf">3.2258</span><span class="p">)</span> <span class="o">-</span> <span class="mi">500</span><span class="p">)</span> <span class="o">/</span> <span class="mf">10.0</span>    

    <span class="k">if</span> <span class="n">format</span><span class="o">==</span><span class="s">&quot;F&quot;</span><span class="p">:</span>
        <span class="c">#convert to farenheit</span>
        <span class="n">tempature</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempature</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">)</span> <span class="o">+</span> <span class="mi">32</span>

    <span class="k">return</span> <span class="n">tempature</span>


<span class="c">#save the reading to the sqllite db</span>
<span class="k">def</span> <span class="nf">save_temp_reading</span> <span class="p">(</span><span class="n">zonestr</span><span class="p">,</span> <span class="n">temp</span><span class="p">):</span>
    <span class="c"># I used triple quotes so that I could break this string into</span>
    <span class="c"># two lines for formatting purposes</span>
    <span class="n">curs</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;INSERT INTO tempature_log values( (?), (?), (?) )&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span> <span class="n">zonestr</span><span class="p">,</span><span class="n">temp</span><span class="p">))</span>

    <span class="c"># commit the changes</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="n">SERIALPORT</span> <span class="o">=</span> <span class="s">&quot;/dev/ttyAMA0&quot;</span>    <span class="c"># the com/serial port the XBee is connected to</span>
<span class="n">BAUDRATE</span> <span class="o">=</span> <span class="mi">9600</span>      <span class="c"># the baud rate we talk to the xbee</span>
<span class="n">TEMPSENSE</span> <span class="o">=</span> <span class="mi">0</span>       <span class="c"># which XBee ADC has current draw data</span>
<span class="n">ROOM</span> <span class="o">=</span> <span class="s">&quot;Room1&quot;</span>  <span class="c"># for now, when we add a second unit we will change this</span>

<span class="n">conn</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tempature.db&#39;</span><span class="p">)</span>

<span class="n">curs</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="n">ser</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="n">SERIALPORT</span><span class="p">,</span> <span class="n">BAUDRATE</span><span class="p">)</span>

<span class="n">xbee</span> <span class="o">=</span> <span class="n">XBee</span><span class="p">(</span><span class="n">ser</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;Starting Up Tempature Monitor&#39;</span>
<span class="c"># Continuously read and print packets</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">xbee</span><span class="o">.</span><span class="n">wait_read_frame</span><span class="p">()</span>
        <span class="c">#print response</span>
        <span class="n">tempature</span> <span class="o">=</span> <span class="n">get_tempature</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s">&#39;samples&#39;</span><span class="p">],</span> <span class="n">format</span><span class="o">=</span><span class="s">&quot;F&quot;</span><span class="p">)</span>  

    <span class="c">#print our timestamp and tempature to standard_out</span>
    <span class="c">#print &quot;{0}, {1}&quot;.format(int(time.time()), tempature)</span>

    <span class="c">#save the tempature to the databse</span>
    <span class="n">save_temp_reading</span><span class="p">(</span><span class="n">ROOM</span><span class="p">,</span> <span class="n">tempature</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="k">break</span>

<span class="n">ser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
<p>I ended up using <a href="http://supervisord.org/">supervisord</a> to manage/daemonize the process.  I sent stdout and stderror to a log file.  </p>

<p>Now that I have the temperature logged in a sqllite db, I want a nice we interface with a d3 graph showing the trend and the current temp. For this I used a flask webserver and one simple jinja template.  Here is the main app.py webserver:</p>
<div class="highlight"><pre><code class="python language-python" data-lang="python"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">Response</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">render_template</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
    <span class="n">DEBUG</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">PROPAGATE_EXCEPTIONS</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>

<span class="n">DATABASE</span> <span class="o">=</span> <span class="s">&#39;../tempature.db&#39;</span>


<span class="k">def</span> <span class="nf">get_db</span><span class="p">():</span>
    <span class="n">db</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s">&#39;_database&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">db</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">_database</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DATABASE</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">db</span>


<span class="c">#select the last entry from the database</span>
<span class="k">def</span> <span class="nf">get_current_temp</span><span class="p">():</span>

    <span class="n">cur</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select * from tempature_log order by timestamp desc limit 1&quot;</span><span class="p">)</span>

    <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">temp</span>


<span class="nd">@app.teardown_appcontext</span>
<span class="k">def</span> <span class="nf">close_connection</span><span class="p">(</span><span class="n">exception</span><span class="p">):</span>
    <span class="n">db</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s">&#39;_database&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">db</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="c">#define the index page, which only needs the current temp to render</span>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">&#39;index.html&#39;</span><span class="p">,</span> <span class="n">current_temp</span> <span class="o">=</span> <span class="n">get_current_temp</span><span class="p">())</span>


<span class="c">#get temps is used via an ajax call with d3.js, to render the graph</span>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/get_temps&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_temp_json</span><span class="p">():</span>

    <span class="n">return_array</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">time_range</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">-</span> <span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mf">24.0</span><span class="p">)</span> <span class="c">#grab the last 24 hours</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM tempature_log WHERE timestamp &gt; ?&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">time_range</span><span class="p">,</span> <span class="p">))</span>

        <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">6</span><span class="p">)</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">return_array</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;x&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">:</span> <span class="n">temp</span><span class="p">})</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">return_array</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">response</span>


<span class="c">#start the app/webserver</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div>
<p>This is my index.html jinja template that includes the d3.js code:</p>
<div class="highlight"><pre><code class="html language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content=</span><span class="s">&quot;IE=edge&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width, initial-scale=1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">content=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;author&quot;</span> <span class="na">content=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;shortcut icon&quot;</span> <span class="na">href=</span><span class="s">&quot;../../assets/ico/favicon.ico&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;title&gt;</span>Narrow Jumbotron Template for Bootstrap<span class="nt">&lt;/title&gt;</span>

    <span class="c">&lt;!-- Bootstrap core CSS --&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;static/bower_components/bootstrap/dist/css/bootstrap.min.css&quot;</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- Custom styles for this template --&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;static/bower_components/bootstrap/dist/css/jumbotron-narrow.css&quot;</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- RickShaw CSS --&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">href=</span><span class="s">&quot;static/bower_components/rickshaw/rickshaw.css&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;https://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;static/bower_components/rickshaw/vendor/d3.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;static/bower_components/rickshaw/vendor/d3.layout.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>

    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;static/bower_components/rickshaw/rickshaw.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>

    <span class="c">&lt;!-- Just for debugging purposes. Don&#39;t actually copy this line! --&gt;</span>
    <span class="c">&lt;!--[if lt IE 9]&gt;&lt;script src=&quot;../../assets/js/ie8-responsive-file-warning.js&quot;&gt;&lt;/script&gt;&lt;![endif]--&gt;</span>

    <span class="c">&lt;!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries --&gt;</span>
    <span class="c">&lt;!--[if lt IE 9]&gt;</span>
<span class="c">      &lt;script src=&quot;https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js&quot;&gt;&lt;/script&gt;</span>
<span class="c">      &lt;script src=&quot;https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js&quot;&gt;&lt;/script&gt;</span>
<span class="c">    &lt;![endif]--&gt;</span>

<span class="nt">&lt;style&gt;</span>
    <span class="nf">#chart_container</span> <span class="p">{</span>
        <span class="k">position</span><span class="o">:</span> <span class="k">relative</span><span class="p">;</span>
        <span class="k">font-family</span><span class="o">:</span> <span class="n">Arial</span><span class="o">,</span> <span class="n">Helvetica</span><span class="o">,</span> <span class="k">sans-serif</span><span class="p">;</span>
        <span class="k">margin</span><span class="o">:</span> <span class="m">30px</span> <span class="m">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nf">#chart</span> <span class="p">{</span>
        <span class="k">position</span><span class="o">:</span> <span class="k">relative</span><span class="p">;</span>
        <span class="k">left</span><span class="o">:</span> <span class="m">40px</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nf">#y_axis</span> <span class="p">{</span>
        <span class="k">position</span><span class="o">:</span> <span class="k">absolute</span><span class="p">;</span>
        <span class="k">top</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">bottom</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">width</span><span class="o">:</span> <span class="m">40px</span><span class="p">;</span>
    <span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>

  <span class="nt">&lt;/head&gt;</span>

  <span class="nt">&lt;body&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;header&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav nav-pills pull-right&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;active&quot;</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>Home<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
        <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">&quot;text-muted&quot;</span><span class="nt">&gt;</span>Temperature Sensor Project<span class="nt">&lt;/h3&gt;</span>
      <span class="nt">&lt;/div&gt;</span>

      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;jumbotron&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h2&gt;</span>Raspberry Pi Temperature Project<span class="nt">&lt;/h2&gt;</span>
        <span class="nt">&lt;h4&gt;</span>Current temp is <span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">&quot;temp&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>.<span class="nt">&lt;/h4&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;chart_container&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;y_axis&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;chart&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>


      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;footer&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;p&gt;</span><span class="ni">&amp;copy;</span> BrettDangerfield.com 2014<span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;/div&gt;</span> <span class="c">&lt;!-- /container --&gt;</span>


    <span class="c">&lt;!-- Bootstrap core JavaScript</span>
<span class="c">    ================================================== --&gt;</span>
    <span class="c">&lt;!-- Placed at the end of the document so the pages load faster --&gt;</span>

<span class="nt">&lt;script&gt;</span>
    <span class="kd">var</span> <span class="nx">graph</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rickshaw</span><span class="p">.</span><span class="nx">Graph</span><span class="p">.</span><span class="nx">Ajax</span><span class="p">(</span> <span class="p">{</span>
        <span class="nx">element</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;#chart&quot;</span><span class="p">),</span>
        <span class="nx">width</span><span class="o">:</span> <span class="mi">540</span><span class="p">,</span>
        <span class="nx">height</span><span class="o">:</span> <span class="mi">240</span><span class="p">,</span>
        <span class="nx">min</span><span class="o">:</span> <span class="mi">74</span><span class="p">,</span>
        <span class="nx">max</span><span class="o">:</span> <span class="mi">82</span><span class="p">,</span>
        <span class="nx">dataURL</span><span class="o">:</span> <span class="s1">&#39;/get_temps&#39;</span><span class="p">,</span>
        <span class="nx">onData</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">[{</span>
                <span class="nx">name</span> <span class="o">:</span> <span class="s2">&quot;Tempature&quot;</span><span class="p">,</span>
                <span class="nx">color</span><span class="o">:</span> <span class="s2">&quot;steelblue&quot;</span><span class="p">,</span>
                <span class="nx">data</span><span class="o">:</span> <span class="nx">data</span>
            <span class="p">}];</span>
            <span class="c1">// or simply return [data[0].strokeVolume_count]; since it looks like a series object already</span>
        <span class="p">},</span>

        <span class="nx">onComplete</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

            <span class="kd">var</span> <span class="nx">x_axis</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rickshaw</span><span class="p">.</span><span class="nx">Graph</span><span class="p">.</span><span class="nx">Axis</span><span class="p">.</span><span class="nx">Time</span><span class="p">({</span>
              <span class="nx">graph</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">graph</span>
            <span class="p">});</span>
            <span class="nx">x_axis</span><span class="p">.</span><span class="nx">graph</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span>

            <span class="kd">var</span> <span class="nx">hoverDetail</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rickshaw</span><span class="p">.</span><span class="nx">Graph</span><span class="p">.</span><span class="nx">HoverDetail</span><span class="p">(</span> <span class="p">{</span>
                <span class="nx">graph</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">graph</span>
            <span class="p">}</span> <span class="p">);</span>

            <span class="kd">var</span> <span class="nx">y_ticks</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rickshaw</span><span class="p">.</span><span class="nx">Graph</span><span class="p">.</span><span class="nx">Axis</span><span class="p">.</span><span class="nx">Y</span><span class="p">(</span> <span class="p">{</span>
                <span class="nx">graph</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">graph</span><span class="p">,</span>
                <span class="nx">orientation</span><span class="o">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                <span class="nx">tickFormat</span><span class="o">:</span> <span class="nx">Rickshaw</span><span class="p">.</span><span class="nx">Fixtures</span><span class="p">.</span><span class="nb">Number</span><span class="p">.</span><span class="nx">formatKMBT</span><span class="p">,</span>
                <span class="nx">element</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;y_axis&#39;</span><span class="p">)</span>
            <span class="p">}</span> <span class="p">);</span>


            <span class="k">this</span><span class="p">.</span><span class="nx">graph</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="p">);</span>


<span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>
<p>I used <a href="http://code.shutterstock.com/rickshaw/">Rickshaw</a> to make dealing with d3 easier.  The graph was pretty simple. I just defined the size, y-min and max and where to get the data.  In the onComplete callback I just setup the x-axis to be a time-based axis, added hover data and turned on the y axis ticks.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">graph</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rickshaw</span><span class="p">.</span><span class="nx">Graph</span><span class="p">.</span><span class="nx">Ajax</span><span class="p">(</span> <span class="p">{</span>
        <span class="nx">element</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;#chart&quot;</span><span class="p">),</span>
        <span class="nx">width</span><span class="o">:</span> <span class="mi">540</span><span class="p">,</span>
        <span class="nx">height</span><span class="o">:</span> <span class="mi">240</span><span class="p">,</span>
        <span class="nx">min</span><span class="o">:</span> <span class="mi">74</span><span class="p">,</span>
        <span class="nx">max</span><span class="o">:</span> <span class="mi">82</span><span class="p">,</span>
        <span class="nx">dataURL</span><span class="o">:</span> <span class="s1">&#39;/get_temps&#39;</span><span class="p">,</span>
        <span class="nx">onData</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">[{</span>
                <span class="nx">name</span> <span class="o">:</span> <span class="s2">&quot;Tempature&quot;</span><span class="p">,</span>
                <span class="nx">color</span><span class="o">:</span> <span class="s2">&quot;steelblue&quot;</span><span class="p">,</span>
                <span class="nx">data</span><span class="o">:</span> <span class="nx">data</span>
            <span class="p">}];</span>
            <span class="c1">// or simply return [data[0].strokeVolume_count]; since it looks like a series object already</span>
        <span class="p">},</span>

        <span class="nx">onComplete</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

            <span class="kd">var</span> <span class="nx">x_axis</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rickshaw</span><span class="p">.</span><span class="nx">Graph</span><span class="p">.</span><span class="nx">Axis</span><span class="p">.</span><span class="nx">Time</span><span class="p">({</span>
              <span class="nx">graph</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">graph</span>
            <span class="p">});</span>
            <span class="nx">x_axis</span><span class="p">.</span><span class="nx">graph</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span>

            <span class="kd">var</span> <span class="nx">hoverDetail</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rickshaw</span><span class="p">.</span><span class="nx">Graph</span><span class="p">.</span><span class="nx">HoverDetail</span><span class="p">(</span> <span class="p">{</span>
                <span class="nx">graph</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">graph</span>
            <span class="p">}</span> <span class="p">);</span>

            <span class="kd">var</span> <span class="nx">y_ticks</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rickshaw</span><span class="p">.</span><span class="nx">Graph</span><span class="p">.</span><span class="nx">Axis</span><span class="p">.</span><span class="nx">Y</span><span class="p">(</span> <span class="p">{</span>
                <span class="nx">graph</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">graph</span><span class="p">,</span>
                <span class="nx">orientation</span><span class="o">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                <span class="nx">tickFormat</span><span class="o">:</span> <span class="nx">Rickshaw</span><span class="p">.</span><span class="nx">Fixtures</span><span class="p">.</span><span class="nb">Number</span><span class="p">.</span><span class="nx">formatKMBT</span><span class="p">,</span>
                <span class="nx">element</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;y_axis&#39;</span><span class="p">)</span>
            <span class="p">}</span> <span class="p">);</span>


            <span class="k">this</span><span class="p">.</span><span class="nx">graph</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="p">);</span>
</code></pre></div>
<p>Now when I start the webserver (as sudo since I am using port 80) and navigate to the pi&#39;s ip in a browser, I get this nice page:</p>

<p><img src="/static/img/pi_screen1.png" width="85%"></p>

<p><strong>Awesome! It Works!!</strong></p>

<h3>Part Four - Soldering and hardening</h3>

<p>Now that everything is working, I want to be able to put this device in my kid&#39;s room without it being so fragile.  For this I bought a $3 box from radioshack and drilled a hole for the USB cable and sensor.  I also soldered the temp sensor to the USB explorer board.  Here is what that looks like:</p>

<p><img src="//lh3.googleusercontent.com/-U00fT7jTTI8/U5KX4GBrXRI/AAAAAAAAEcQ/w34vqlHb9AA/w836-h1114-no/IMG_20140606_224057.jpg" width="75%"></p>

<p><img src="https://lh6.googleusercontent.com/-okIXt9sG418/U5KYSH9ULtI/AAAAAAAAEWM/qkX2CAW-JjU/w836-h1114-no/IMG_20140606_224230.jpg" width="75%"></p>

<h3>What&#39;s Next</h3>

<p>Now that I have a working prototype I would like to build one or two more sensors and modify the graph to show the trend of each location overlayed on top of each other. I would also like to be able to change the date range and zoom in and out on the graph. Eventually, I would like to get a network enabled thermostat and have my pi turn the heat/ac on or off based on location, time of day, temp ect. Maybe build some smart rules to control the climate in my house. The single thermostat reading just doesn&#39;t cut it because the temp varies so much from room to room.</p>

<p>Here is the source code from github:</p>

<h2>Code:</h2>

<p><strong><a class="btn btn-large" href="https://github.com/brettdanger/pi_arduino"><i class="fa fa-github" target="_blank"></i>&nbsp;&nbsp; PI Temp Sensor Code</a></strong></p>
</div>
<div class="clearfix"></div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'brettdangerblog'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'brettdangerblog'; // required: replace example with your forum shortname
      var disqus_url = 'http://www.brettdangerfield.com/post/raspberrypi_tempature_monitor_project';
      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
<script type="text/javascript">

</script>


            </div><!--/span-->
            <!-- sidebar here -->
            <div class="col-lg-3 col-md-4 col-sm-4 sidebar">
    <div class="widget-sidebar widget_top-posts">
      <h3>Popular Posts</h3>
      <ul>
        
            
        
            
        
            
        
            
        
            
        
            
            <li>
                <div class="post-wrapper">
                     
                        <div class="post-img" style="background: url(https://cdn.sparkfun.com//assets/parts/6/8/0/5/11215-01.jpg);"></div>
                    
                    <div class="post-text">
                        <div class="post-meta">
                            <span><em>in</em> <a href="/category/programmingelectronics" title="Programming" rel="category tag">Programming</a></span>
                            <span><em>13 Jun 2014</em></span>
                        </div>
                        <div class="heading-title">
                            <h2><a href="/post/raspberrypi_tempature_monitor_project">Building a wireless temperature sensor with a Raspberry Pi and Xbee Wireless modules</a></h2>
                        </div>
                    </div>
                </div>
            </li>
            
        
            
        
            
        
            
            <li>
                <div class="post-wrapper">
                     
                        <div class="post-img" style="background: url(/static/img/tag_cloud.png);"></div>
                    
                    <div class="post-text">
                        <div class="post-meta">
                            <span><em>in</em> <a href="/category/programming" title="Programming" rel="category tag">Programming</a></span>
                            <span><em>01 May 2014</em></span>
                        </div>
                        <div class="heading-title">
                            <h2><a href="/post/realtime_data_tag_cloud">Playing with REALTIME data, Python and D3</a></h2>
                        </div>
                    </div>
                </div>
            </li>
            
        
            
        
            
        
            
            <li>
                <div class="post-wrapper">
                     
                        <div class="post-img" style="background: url(/static/img/mooc_python.png);"></div>
                    
                    <div class="post-text">
                        <div class="post-meta">
                            <span><em>in</em> <a href="/category/programming" title="Programming" rel="category tag">Programming</a></span>
                            <span><em>14 Apr 2014</em></span>
                        </div>
                        <div class="heading-title">
                            <h2><a href="/post/full_stack_mooc_app_part_1_python_backend">Mooc Aggregator Project, Python backend with MongoDB and SQLAlachemy</a></h2>
                        </div>
                    </div>
                </div>
            </li>
            
        
            
        
            
        
            
        
            
        
            
        
            
            <li>
                <div class="post-wrapper">
                     
                        <div class="post-img" style="background: url(http://www.afrobella.com/wp-content/uploads/2012/12/Django-Unchained-wallpapers-1920x1200-2.jpg);"></div>
                    
                    <div class="post-text">
                        <div class="post-meta">
                            <span><em>in</em> <a href="/category/programming" title="Programming" rel="category tag">Programming</a></span>
                            <span><em>04 Jan 2013</em></span>
                        </div>
                        <div class="heading-title">
                            <h2><a href="/post/django_vs_pyramid">Django vs Pyramid - My Comparison</a></h2>
                        </div>
                    </div>
                </div>
            </li>
            
        
            
        
            
        
            
            <li>
                <div class="post-wrapper">
                     
                        <div class="post-img" style="background: url(http://www.pylonsproject.org/static/images/pyramid-small.png);"></div>
                    
                    <div class="post-text">
                        <div class="post-meta">
                            <span><em>in</em> <a href="/category/programming" title="Programming" rel="category tag">Programming</a></span>
                            <span><em>07 Sep 2012</em></span>
                        </div>
                        <div class="heading-title">
                            <h2><a href="/post/creating_a_blog_with_pyramid_mongdb_bootstrap">Creating a blog engine with Python, Pyramid, MongoDB and Twitter Bootstrap</a></h2>
                        </div>
                    </div>
                </div>
            </li>
            
        
            
        
            
         
      </ul>
    </div>

    <div class="widget-sidebar widget_categories">
      <h3>Categories</h3>
      <ul>
        
            <li><a href="/category/programming">Programming</a></li>
        
            <li><a href="/category/personal">Personal</a></li>
        
            <li><a href="/category/fatherhood">Fatherhood</a></li>
        
            <li><a href="/category/sports">Sports</a></li>
        
            <li><a href="/category/technology">Technology</a></li>
        
            <li><a href="/category/electronics">Electronics</a></li>
        
            <li><a href="/category/travel">Travel</a></li>
        
            <li><a href="/category/career">Career</a></li>
        
      </ul>
    </div>

    <div class="widget-sidebar widget_top-posts">
      <h3>Recent Posts</h3>
      <ul>
        
        
        <li>
            <div class="post-wrapper">

                <div class="post-text">
                    <div class="post-meta">
                        <span><em>in</em> <a href="/category/personalcareerprogramming" title="Personal" rel="category tag">Personal</a></span>
                        <span><em>07 Jan 2015</em></span>
                    </div>
                    <div class="heading-title">
                        <h2><a href="/post/2014_career_overview">2014 and My Transition to Engineering Manager</a></h2>
                    </div>
                </div>
            </div>
        </li>
        
        
        
        
        
        
        
        <li>
            <div class="post-wrapper">

                <div class="post-text">
                    <div class="post-meta">
                        <span><em>in</em> <a href="/category/travelfatherhood" title="Travel" rel="category tag">Travel</a></span>
                        <span><em>24 Jun 2014</em></span>
                    </div>
                    <div class="heading-title">
                        <h2><a href="/post/first_rv_trip_mount_rushmore_black_hills">Holiday Road: Trip 1 - Black Hills and Mount Rushmore</a></h2>
                    </div>
                </div>
            </div>
        </li>
        
        
        
        
        
        <li>
            <div class="post-wrapper">

                <div class="post-text">
                    <div class="post-meta">
                        <span><em>in</em> <a href="/category/programmingelectronics" title="Programming" rel="category tag">Programming</a></span>
                        <span><em>13 Jun 2014</em></span>
                    </div>
                    <div class="heading-title">
                        <h2><a href="/post/raspberrypi_tempature_monitor_project">Building a wireless temperature sensor with a Raspberry Pi and Xbee Wireless modules</a></h2>
                    </div>
                </div>
            </div>
        </li>
        
        
        
        
        
        
        
        <li>
            <div class="post-wrapper">

                <div class="post-text">
                    <div class="post-meta">
                        <span><em>in</em> <a href="/category/programming" title="Programming" rel="category tag">Programming</a></span>
                        <span><em>01 May 2014</em></span>
                    </div>
                    <div class="heading-title">
                        <h2><a href="/post/realtime_data_tag_cloud">Playing with REALTIME data, Python and D3</a></h2>
                    </div>
                </div>
            </div>
        </li>
        
        
        
        <li>
            <div class="post-wrapper">

                <div class="post-text">
                    <div class="post-meta">
                        <span><em>in</em> <a href="/category/technology" title="Technology" rel="category tag">Technology</a></span>
                        <span><em>25 Apr 2014</em></span>
                    </div>
                    <div class="heading-title">
                        <h2><a href="/post/replacing_slr_with_compact_mirrorless_samsung_nx300">Replacing my DSLR with a compact mirrorless camera, the NX300</a></h2>
                    </div>
                </div>
            </div>
        </li>
        
        
        
        <li>
            <div class="post-wrapper">

                <div class="post-text">
                    <div class="post-meta">
                        <span><em>in</em> <a href="/category/programming" title="Programming" rel="category tag">Programming</a></span>
                        <span><em>22 Apr 2014</em></span>
                    </div>
                    <div class="heading-title">
                        <h2><a href="/post/full_stack_mooc_app_part_1_continued_saving_to_mongodb">Mooc Aggregator Project, Python backend Continued, saving to mongodb and postgres</a></h2>
                    </div>
                </div>
            </div>
        </li>
        
        
        
        <li>
            <div class="post-wrapper">

                <div class="post-text">
                    <div class="post-meta">
                        <span><em>in</em> <a href="/category/programming" title="Programming" rel="category tag">Programming</a></span>
                        <span><em>14 Apr 2014</em></span>
                    </div>
                    <div class="heading-title">
                        <h2><a href="/post/full_stack_mooc_app_part_1_python_backend">Mooc Aggregator Project, Python backend with MongoDB and SQLAlachemy</a></h2>
                    </div>
                </div>
            </div>
        </li>
        
         
      </ul>
    </div>
</div>

        </div> <!-- end row -->
      </div>
</section>
    <!-- end:content -->
<!-- Footer HERE -->
   
<!-- begin:copyright -->
<section id="copyright">
  <div class="container">
    <div class="row">
      <div class="col-md-6 col-sm-6 copy-left">
        <p>Copyright &copy; 2014 <strong><a href="/">brettdangerfield.com</a></strong>. <span style="float: right">Hosted on <a href="http://www.github.com/brettdanger/published_blog/">Github</a> | Powered by <a href="http://jekyllrb.com">Jekyll</a></span></p>
      </div>

      <div class="col-md-6 col-sm-6 copy-right">
        <ul class="list-inline social-icon">
          <li><a href="http://www.twitter.com/brettdanger" class="icon-twitter" rel="tooltip" title="" data-placement="top" data-original-title="Twitter"><i class="fa fa-twitter"></i></a></li>
          <li><a href="http://www.facebook.com/brettdanger" class="icon-facebook" rel="tooltip" title="" data-placement="top" data-original-title="Facebook"><i class="fa fa-facebook-square"></i></a></li>
          <li><a href="http://www.linkedin.com/pub/brett-dangerfield/8/150/392" class="icon-linkedin" rel="tooltip" title="" data-placement="top" data-original-title="LinkedIn"><i class="fa fa-linkedin"></i></a></li>
          <li><a href="http://github.com/brettdanger" class="icon-github" rel="tooltip" title="" data-placement="top" data-original-title="Github"><i class="fa fa-github"></i></a></li>
          <li><a href="https://plus.google.com/+BrettDangerfield" class="icon-googleplus" rel="tooltip" title="" data-placement="top" data-original-title="Google Plus"><i class="fa fa-google-plus"></i></a></li>
        </ul>
      </div>
    </div>
  </div>
</section>
<!-- end:copyrigt -->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
   <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/static/js/bootstrap.js"></script>
    <script src="/static/js/masonry.pkgd.min.js"></script>
    <script src="/static/js/imagesloaded.pkgd.min.js"></script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&amp;language=en"></script>
    <script src="/static/js/gmap3.min.js"></script>
    <script src="/static/js/jquery.isotope.min.js"></script>
    <script src="/static/js/jquery.easing.js"></script>
    <script src="/static/js/script.js"></script>
    <script type="text/javascript" src="/static/js/prettify/prettify.js"></script>


  </body>
</html>

