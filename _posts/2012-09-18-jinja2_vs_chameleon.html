---
layout: post
title: "Searching for a new python template system, Jinja2 to the rescue!"
date: 2012-09-18 10:34:22
categories: programming
tags: [jinja2, python, pyramid, chameleon, django]
---

{% raw %}
<p>In my <a href="http://www.brettdangerfield.com/post/creating_a_blog_with_pyramid_mongdb_bootstrap">previous post</a> about creating a blog with Pyramid, I mentioned that I really didn't like Chameleon or Mako <em>(To be fair I never really tried Mako; I just read through the documentation trying to understand how to perform inheritance)</em> templates.  A commenter(thanks Matt) suggested I give <a href="http://jinja.pocoo.org/docs/" target="_blank">Jinja2</a> a try.  Some of my gripes (or my lack of understanding) about the those template engines were:</p>
<ul>
    <li>I couldn't find an easy way to break my templates into various pieces like header, footer, sidebar etc.  Then have a layout template that pulls them in, and lastly inserts my individual view on top of that portion of the template. </li>
    <li>The syntax should be easy and I believe template portions of your markup should stand out from the static markup.</li>
    <li>I don't have any concern over speed or jython compatibility and this seems to be a major focus for chameleon.</li>
</ul>
 <p>Chameleon uses a macro language called METAL and it adds a bunch of extra markup to your document and making it less clear over which parts were part of the template and which were static.  This became apparent when I was retrofitting my templates to Jinja2 and ripping out the chameleon parts, I kept finding remains of the chameleon templates after I had made the switch.  <!--more--> With Chameleon, I was able to create a structure layout and then use macros to create the portions for each view, for instance my homepage template looked like this:</p>
 <pre class="prettyprint lang-xml"><metal:main use-macro="load: structure.pt"><span class="pln"><span class="pln">
</span></span><span class="tag"><span class="tag">&lt;div</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">metal:fill-slot</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"main_content"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="pln"><span class="pln">
  </span></span><span class="tag"><span class="tag">&lt;div</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">tal:repeat</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"entry entries"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">class</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"hero-unit"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="pln"><span class="pln">
            </span></span><span class="tag"><span class="tag">&lt;h3&gt;&lt;a</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">href</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"/post/${structure: entry.url}"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="pln"><span class="pln">${structure: entry.title}</span></span><span class="tag"><span class="tag">&lt;/a&gt;&lt;/h3&gt;</span></span><span class="pln"><span class="pln">
            </span></span><span class="tag"><span class="tag">&lt;h4&gt;</span></span><span class="pln"><span class="pln">${structure: entry.date}</span></span><span class="tag"><span class="tag">&lt;/h4&gt;</span></span><span class="pln"><span class="pln">
            </span></span><span class="tag"><span class="tag">&lt;p</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">tal:content</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"structure: entry.blog_body"</span></span><span class="tag"><span class="tag">&gt;&lt;/p&gt;</span></span><span class="pln"><span class="pln">

            </span></span><span class="tag"><span class="tag">&lt;p&gt;&lt;a</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">class</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"btn btn-primary"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">href</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"/post/${structure: entry.url}"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="pln"><span class="pln">Read Post »</span></span><span class="tag"><span class="tag">&lt;/a&gt;&lt;/p&gt;</span></span><span class="pln"><span class="pln">
            </span></span><span class="tag"><span class="tag">&lt;p&gt;&lt;/p&gt;&lt;h4&gt;&lt;a</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">href</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"/post/${structure: entry.url}#disqus_thread"</span></span><span class="tag"><span class="tag">&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;/p&gt;</span></span><span class="pln"><span class="pln">
            </span></span><span class="tag"><span class="tag">&lt;i</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">class</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"icon-tags icon-large"</span></span><span class="tag"><span class="tag">&gt;&lt;/i&gt;</span></span><span class="pln"><span class="pln">&nbsp;</span></span><span class="tag"><span class="tag">&lt;span</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">tal:repeat</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"tag entry.tags"</span></span><span class="tag"><span class="tag">&gt;&lt;a</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">href</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"/tag/${structure: tag}"</span></span><span class="pln"><span class="pln"> </span></span><span class="atn"><span class="atn">class</span></span><span class="pun"><span class="pun">=</span></span><span class="atv"><span class="atv">"label label-success"</span></span><span class="tag"><span class="tag">&gt;</span></span><span class="pln"><span class="pln">${structure: tag</span></span><span class="tag"><span class="tag">&lt;/a&gt;</span></span><span class="pln"><span class="pln">
</span></span><span class="tag"><span class="tag">&lt;/span&gt;</span></span><span class="pln"><span class="pln">
          </span></span><span class="tag"><span class="tag">&lt;/div&gt;</span></span><span class="pln"><span class="pln">
  </span></span><span class="tag"><span class="tag">&lt;/div&gt;</span></span><span class="pln"><span class="pln">
</span></span><span class="tag"><span class="tag">&lt;/metal:main&gt;</span></span></metal:main></pre>

<p>This allowed me to create a main skeleton that included my header and footer, but what if I wanted another page that used a left nav layout instead of a right one? Then I would have to create another structure template and copy/paste the header, footer, etc into the new template, thus breaking DRY principles. Also notice the metal: and tal: attributes in my markup. It is easy to see that the template parts that are wrapped in curly braces but the template system bleeds out to my markup.  Jinja made this whole process much easier and flexible.  I was able to install Jinja2 into my project by following <a href="http://docs.pylonsproject.org/projects/pyramid_jinja2/en/latest/?awesome" target="_blank">these steps</a>.</p>
<p>I was then able to pull out my parts and place them into their own .jinja2 files like my header.jinja2 template here:
    </p><pre class="prettyprint lang-xml"><span class="pln">        </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"navbar navbar-fixed-top"</span><span class="tag">&gt;</span><span class="pln">
              </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"navbar-inner"</span><span class="tag">&gt;</span><span class="pln">
                </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"container"</span><span class="tag">&gt;</span><span class="pln">
                  </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"btn btn-navbar"</span><span class="pln"> </span><span class="atn">data-toggle</span><span class="pun">=</span><span class="atv">"collapse"</span><span class="pln"> </span><span class="atn">data-target</span><span class="pun">=</span><span class="atv">".nav-collapse"</span><span class="tag">&gt;</span><span class="pln">
                    </span><span class="tag">&lt;span</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"icon-bar"</span><span class="tag">&gt;&lt;/span&gt;</span><span class="pln">
                    </span><span class="tag">&lt;span</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"icon-bar"</span><span class="tag">&gt;&lt;/span&gt;</span><span class="pln">
                    </span><span class="tag">&lt;span</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"icon-bar"</span><span class="tag">&gt;&lt;/span&gt;</span><span class="pln">
                  </span><span class="tag">&lt;/a&gt;</span><span class="pln">
                  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"span6 offset1"</span><span class="tag">&gt;</span><span class="pln">
                    </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"logo"</span><span class="tag">&gt;&lt;img</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"/static/img/bio48.png"</span><span class="pln"> </span><span class="tag">/&gt;&lt;/div&gt;</span><span class="pln">
                    </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"brand"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"/"</span><span class="tag">&gt;</span><span class="pln">{{static_info.blog_title}}</span><span class="tag">&lt;/a&gt;</span><span class="pln">
                    </span><span class="tag">&lt;p</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">'tag-line'</span><span class="tag">&gt;</span><span class="pln">{{static_info.site_motto}}</span><span class="tag">&lt;/p&gt;</span><span class="pln">
                  </span><span class="tag">&lt;/div&gt;</span><span class="pln">
                  </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"nav-collapse"</span><span class="tag">&gt;</span><span class="pln">
                    </span><span class="tag">&lt;ul</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"nav"</span><span class="tag">&gt;</span><span class="pln">
                      </span><span class="tag">&lt;li</span><span class="pln">  </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"{% if cur_page == 'home' %} active {% endif %}"</span><span class="tag">&gt;&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"/"</span><span class="tag">&gt;&lt;i</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"icon-home icon-large"</span><span class="tag">&gt;&lt;/i&gt;</span><span class="pln">Home</span><span class="tag">&lt;/a&gt;&lt;/li&gt;</span><span class="pln">
                      </span><span class="tag">&lt;li</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"{% if cur_page == 'about' %} active {% endif %}"</span><span class="tag">&gt;&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"/page/about"</span><span class="tag">&gt;&lt;i</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"icon-user icon-large"</span><span class="tag">&gt;&lt;/i&gt;</span><span class="pln">About</span><span class="tag">&lt;/a&gt;&lt;/li&gt;</span><span class="pln">
                      </span><span class="tag">&lt;/ul&gt;</span><span class="pln">
                  </span><span class="tag">&lt;/div&gt;</span><span class="com">&lt;!--/.nav-collapse --&gt;</span><span class="pln">
                </span><span class="tag">&lt;/div&gt;</span><span class="pln">
              </span><span class="tag">&lt;/div&gt;</span><span class="pln">
            </span><span class="tag">&lt;/div&gt;</span><span class="pln">
    </span></pre>
    Then I was able to create a layout_right.jinja2 template that pulled in all the pieces using includes like so: {% include 'header.jinja2' %}.  This was exactly what I was looking for, now on my individual views, like my homepage I could tell it which layout to use and all the pieces come with it.  My new home template looks like this:
    <pre class="prettyprint lang-xml"><span class="pln">        {% extends "layout_right.jinja2" %}
        {% block title %}Welcome To Brett's Blog{% endblock %}
        {% block head %}
            {{ super() }}
        {% endblock %}
        {% block content %}
            </span><span class="tag">&lt;div&gt;</span><span class="pln">
              {% for entry in entries %}
              </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"hero-unit"</span><span class="tag">&gt;</span><span class="pln">
                </span><span class="tag">&lt;h3&gt;&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"/post/{{entry.url}}"</span><span class="tag">&gt;</span><span class="pln">{{entry.title}}</span><span class="tag">&lt;/a&gt;&lt;/h3&gt;</span><span class="pln">
                </span><span class="tag">&lt;h4&gt;</span><span class="pln">{{entry.date}}</span><span class="tag">&lt;/h4&gt;</span><span class="pln">
                </span><span class="tag">&lt;p&gt;</span><span class="pln">{{entry.blog_body | safe}}</span><span class="tag">&lt;/p&gt;</span><span class="pln">

                </span><span class="tag">&lt;p&gt;&lt;a</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"btn btn-primary"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"/post/{{entry.url}}"</span><span class="tag">&gt;</span><span class="pln">Read Post »</span><span class="tag">&lt;/a&gt;&lt;/p&gt;</span><span class="pln">
                </span><span class="tag">&lt;h4&gt;&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"/post/{{entry.url}}#disqus_thread"</span><span class="tag">&gt;&lt;/a&gt;&lt;/h4&gt;</span><span class="pln">
                </span><span class="tag">&lt;p&gt;&lt;i</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"icon-tags icon-large"</span><span class="tag">&gt;&lt;/i&gt;</span><span class="pln">&nbsp;{% for tag in entry.tags %}&nbsp;</span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"/tag/{{tag}}"</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"label label-success"</span><span class="tag">&gt;</span><span class="pln">{{tag}}</span><span class="tag">&lt;/a&gt;</span><span class="pln">{% endfor %}</span><span class="tag">&lt;/p&gt;</span><span class="pln">
              </span><span class="tag">&lt;/div&gt;</span><span class="pln">
              {% endfor %}
          </span><span class="tag">&lt;/div&gt;</span><span class="pln">
        {% endblock %}
    </span></pre>
    As you can see here, all the parts of the template are wrapped including the for statements, which makes it much easier to identify the static markup from the dynamic template pieces.  Jinja2 was exactly the template system I was looking for.  I updated my github source to use Jinja2, you can find it <a href="https://github.com/brettdanger/pyramid-mongo-blog" target="_blank">here</a>.
    {% endraw %}